<!-- ===== CONTENIDO PRINCIPAL ===== -->
<main>

  <!-- INDICADOR DE CARGA -->
  <div *ngIf="cargando" style="text-align: center; padding: 3rem; background: rgba(30, 41, 59, 0.6); border-radius: 1rem; margin-bottom: 2rem;">
    <div style="display: inline-block; width: 50px; height: 50px; border: 4px solid rgba(251, 191, 36, 0.2); border-top-color: #fbbf24; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 1rem; color: #cbd5e1; font-size: 1.125rem;">Cargando datos desde Firebase...</p>
  </div>

  <!-- ESTADO EN TIEMPO REAL -->
  <section class="parking-status">
    <div class="status-header">
      <h2>ğŸ…¿ï¸ Estado del Estacionamiento en Tiempo Real</h2>
      <div class="status-indicators">
        <div class="indicator disponibles">
          ğŸŸ¢ <span>{{ espaciosLibres }}</span> Libres
        </div>
        <div class="indicator ocupados">
          ğŸ”´ <span>{{ espaciosOcupados }}</span> Ocupados
        </div>
        <div class="indicator total">
          ğŸ“Š <span>{{ espaciosTotal }}</span> Total
        </div>
        <button class="btn-refresh" (click)="actualizarEstadisticas()" [disabled]="procesando">
          ğŸ”„ Actualizar
        </button>
      </div>
    </div>
    
    <!-- GRID DE ESPACIOS DINÃMICO -->
    <div class="spaces-grid">
      <div
        *ngFor="let espacio of espaciosUI"
        [ngClass]="obtenerClaseEspacio(espacio)"
        (click)="mostrarDetallesEspacio(espacio)"
        [title]="espacio.ocupado ? 'Click para ver detalles' : 'Espacio disponible'"
      >
        <div class="space-number">E-{{ espacio.numero < 10 ? '0' + espacio.numero : espacio.numero }}</div>
        <div class="space-label">{{ obtenerTextoEspacio(espacio) }}</div>
        <div class="space-placa" *ngIf="espacio.ocupado && espacio.placa">
          {{ espacio.placa }}
        </div>
      </div>
    </div>
  </section>

  <div class="dashboard-grid">

    <!-- FORMULARIO DE REGISTRO -->
    <section class="registro">
      <h2>ğŸ“‹ Registrar Entrada de VehÃ­culo</h2>
      
      <form (submit)="registrarVehiculo($event)">
        <div class="form-group">
          <label for="placa">Placa del VehÃ­culo *</label>
          <input 
            type="text" 
            id="placa" 
            placeholder="ABC-123" 
            required
            [disabled]="procesando"
            maxlength="10"
            style="text-transform: uppercase;"
          >
        </div>
        
        <div class="form-group">
          <label for="propietario">Propietario *</label>
          <input 
            type="text" 
            id="propietario" 
            placeholder="Juan PÃ©rez" 
            required
            [disabled]="procesando"
          >
        </div>
        
        <div class="form-group">
          <label for="tipo">Tipo de VehÃ­culo *</label>
          <select id="tipo" required [disabled]="procesando">
            <option value="">Seleccionar tipo</option>
            <option value="Auto">Auto ğŸš—</option>
            <option value="Moto">Moto ğŸï¸</option>
            <option value="Camioneta">Camioneta ğŸš™</option>
            <option value="SUV">SUV ğŸš</option>
            <option value="CamiÃ³n">CamiÃ³n ğŸšš</option>
          </select>
        </div>
        
        <button type="submit" [disabled]="procesando || espaciosLibres === 0">
          <span *ngIf="!procesando">âœ“ Registrar Entrada</span>
          <span *ngIf="procesando">â³ Procesando...</span>
        </button>

        <div *ngIf="espaciosLibres === 0" style="margin-top: 1rem; padding: 0.875rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem; color: #f87171; text-align: center; font-weight: 600;">
          âš ï¸ No hay espacios disponibles
        </div>
      </form>
      
      <div id="mensaje" class="mensaje" style="display: none;"></div>
    </section>
    
    <!-- TABLA DE VEHÃCULOS EN TIEMPO REAL -->
    <section class="tabla">
      <h2>ğŸš— VehÃ­culos Registrados (Tiempo Real)</h2>
      
      <!-- FILTROS RÃPIDOS -->
      <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
        <button 
          (click)="cambiarFiltro('todos')"
          [style.background]="filtroActual === 'todos' ? 'rgba(251, 191, 36, 0.2)' : 'rgba(15, 23, 42, 0.6)'"
          [style.color]="filtroActual === 'todos' ? '#fbbf24' : '#cbd5e1'"
          [style.border]="filtroActual === 'todos' ? '1px solid rgba(251, 191, 36, 0.3)' : '1px solid rgba(148, 163, 184, 0.2)'"
          style="padding: 0.625rem 1.25rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.3s ease;"
        >
          ğŸ“‹ Todos ({{ vehiculos.length }})
        </button>
        <button 
          (click)="cambiarFiltro('activos')"
          [style.background]="filtroActual === 'activos' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(15, 23, 42, 0.6)'"
          [style.color]="filtroActual === 'activos' ? '#34d399' : '#cbd5e1'"
          [style.border]="filtroActual === 'activos' ? '1px solid rgba(16, 185, 129, 0.3)' : '1px solid rgba(148, 163, 184, 0.2)'"
          style="padding: 0.625rem 1.25rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.3s ease;"
        >
          âœ… Activos ({{ vehiculosActivos }})
        </button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ESPACIO</th>
              <th>PLACA</th>
              <th>PROPIETARIO</th>
              <th>TIPO</th>
              <th>HORA ENTRADA</th>
              <th>HORA SALIDA</th>
              <th>DURACIÃ“N</th>
              <th>ESTADO</th>
              <th>ACCIÃ“N</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="vehiculosFiltrados.length === 0 && !cargando">
              <td colspan="9" style="text-align:center; padding: 2rem; color: #64748b;">
                ğŸ”­ No hay vehÃ­culos {{ filtroActual === 'activos' ? 'activos' : 'registrados' }} actualmente.
              </td>
            </tr>
            
            <tr *ngIf="cargando">
              <td colspan="9" style="text-align:center; padding: 2rem;">
                <div style="display: inline-block; width: 30px; height: 30px; border: 3px solid rgba(251, 191, 36, 0.2); border-top-color: #fbbf24; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 0.5rem; color: #94a3b8;">Cargando vehÃ­culos...</p>
              </td>
            </tr>

            <tr *ngFor="let vehiculo of vehiculosFiltrados">
              <td>
                <div class="espacio-col">
                  E-{{ vehiculo.espacioNumero ? (vehiculo.espacioNumero < 10 ? '0' + vehiculo.espacioNumero : vehiculo.espacioNumero) : '-' }}
                </div>
              </td>
              <td>
                <span class="placa-badge">{{ vehiculo.placa }}</span>
              </td>
              <td>{{ vehiculo.propietario }}</td>
              <td>{{ vehiculo.tipo }}</td>
              <td>{{ formatearFecha(vehiculo.horaEntrada) }}</td>
              <td>
                {{ vehiculo.horaSalida ? formatearFecha(vehiculo.horaSalida) : '-' }}
              </td>
              <td>{{ vehiculo.duracion || '-' }}</td>
              <td>
                <span [class]="vehiculo.estado === 'Dentro' ? 'badge-activo' : 'badge-finalizado'">
                  {{ vehiculo.estado === 'Dentro' ? 'ACTIVO' : 'FINALIZADO' }}
                </span>
              </td>
              <td>
                <button 
                  *ngIf="vehiculo.estado === 'Dentro'" 
                  (click)="finalizarVehiculo(vehiculo)"
                  class="btn-salida"
                  [disabled]="procesando"
                >
                  ğŸš€ Registrar Salida
                </button>
                <span 
                  *ngIf="vehiculo.estado === 'Fuera'" 
                  style="color: #64748b; font-size: 0.875rem;"
                >
                  âœ“ Completado
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- ESTADÃSTICAS RÃPIDAS EN TIEMPO REAL -->
  <section class="quick-stats">
    <h2>ğŸ“Š EstadÃ­sticas de Hoy (ActualizaciÃ³n AutomÃ¡tica)</h2>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸš—</div>
        <div class="stat-label">VehÃ­culos Hoy</div>
        <div class="stat-value">{{ vehiculosHoy }}</div>
      </div>

      <div class="stat-card">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">âœ…</div>
        <div class="stat-label">Activos Ahora</div>
        <div class="stat-value">{{ vehiculosActivos }}</div>
        <div style="color: #64748b; font-size: 0.75rem; margin-top: 0.5rem;">{{ porcentajeOcupacion }}% ocupaciÃ³n</div>
      </div>

      <div class="stat-card">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">â±ï¸</div>
        <div class="stat-label">Tiempo Promedio</div>
        <div class="stat-value" style="font-size: 1.5rem;">{{ tiempoPromedio }}</div>
        <div style="color: #64748b; font-size: 0.75rem; margin-top: 0.5rem;">DuraciÃ³n estancia</div>
      </div>

      <div class="stat-card">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ…¿ï¸</div>
        <div class="stat-label">Espacios Libres</div>
        <div class="stat-value">{{ espaciosLibres }}</div>
        <div style="color: #64748b; font-size: 0.75rem; margin-top: 0.5rem;">de {{ espaciosTotal }} total</div>
      </div>
    </div>
  </section>
<!-- Al final de vehiculos.html, antes de </main> -->

<!-- ğŸ†• MODAL COMPONENT -->
<app-modal
  [isOpen]="modalOpen"
  [config]="modalConfig"
  (onConfirm)="confirmarSalida()"
  (onCancel)="cancelarModal()"
  (onClose)="cerrarModal()">
</app-modal>

</main>



<!-- AnimaciÃ³n de spin -->
<style>
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>